<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign In — OrbitalScan</title>
  <meta name="description" content="Sign in with your email to access OrbitalScan members portal." />
  <style>
    :root{
      --bg:#0b0b13;
      --card:#121223;
      --card2:#141428;
      --text:#e9e9f1;
      --muted:#b7b7c9;
      --primary:#8a5cff;
      --accent:#3dd3ff;
      --ring:0 0 0 2px rgba(61,211,255,0.2),0 0 30px rgba(138,92,255,0.15);
      --warn:#ffb020;
      --bad:#ff4d6d;
    }
    *{box-sizing:border-box}
    body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif;line-height:1.6}
    a{color:inherit;text-decoration:none}
    .container{max-width:520px;margin:0 auto;padding:24px}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));}
    .brand h1{font-size:18px;margin:0;font-weight:700}
    .menu{display:flex;gap:18px;align-items:center}
    .menu a{opacity:.9;padding:8px 10px;border-radius:10px}
    .menu a:hover{background:rgba(255,255,255,.05)}
    h2{font-size:28px;margin-top:6px}
    .lead{color:var(--muted)}
    .card{background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:20px}
    .field{display:grid;gap:8px;margin:12px 0}
    input[type="email"]{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:#0e0e19;color:var(--text)}
    .btn{display:inline-flex;justify-content:center;align-items:center;gap:8px;width:100%;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer;border:1px solid rgba(255,255,255,.12)}
    .btn-primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#0b0b13;border:0;box-shadow:var(--ring)}
    .btn-ghost{background:transparent}
    .hint{color:var(--muted);font-size:12px;margin-top:8px}
    .error{background:rgba(255,77,109,.12);border:1px solid rgba(255,77,109,.4);color:#ffccd6;padding:10px 12px;border-radius:10px;margin-top:10px;display:none}
    footer{margin-top:30px;padding:20px 0;color:var(--muted);border-top:1px solid rgba(255,255,255,.1);text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <div class="brand">
        <div class="logo"></div>
        <h1>OrbitalScan</h1>
      </div>
      <div class="menu">
        <a href="index.html">Home</a>
        <a href="pricing.html">Pricing</a>
        <a href="signals.html">Members</a>
      </div>
    </nav>

    <header>
      <h2>Sign in</h2>
      <p class="lead">Enter your email. We'll check your membership status instantly.</p>
    </header>

    <section class="card">
      <form id="emailForm">
        <label for="email">Email</label>
        <div class="field">
          <input id="email" name="email" type="email" placeholder="you@mail.com" required />
          <button class="btn btn-primary" type="submit">Continue with Email</button>
        </div>
        <div id="err" class="error"></div>
      </form>

      <p class="hint">No access yet? <a href="pricing.html">Choose a plan</a>.</p>
    </section>

    <footer>
      © <span id="y"></span> OrbitalScan
    </footer>
  </div>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    const form = document.getElementById('emailForm');
    const errBox = document.getElementById('err');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errBox.style.display = 'none';
      const email = (document.getElementById('email').value || '').trim().toLowerCase();
      if(!email) return;

      try {
        const url = '/.netlify/functions/get-membership?email=' + encodeURIComponent(email);
        const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
        if (!res.ok) throw new Error('Server error');
        const data = await res.json();

        if (data.ok && data.active) {
          // Save session locally (temporary until full auth)
          localStorage.setItem('os_member','active');
          localStorage.setItem('os_email', email);
          // Redirect to dashboard
          window.location.href = 'dashboard.html';
        } else {
          // Not active: send to pricing
          localStorage.removeItem('os_member');
          localStorage.removeItem('os_email');
          window.location.href = 'pricing.html';
        }
      } catch (err) {
        errBox.textContent = 'Unable to verify membership right now. Please try again.';
        errBox.style.display = 'block';
      }
    });
  </script>
</body>
</html>
